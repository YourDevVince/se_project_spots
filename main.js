!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__save-btn",deleteButtonSelector:".modal__delete-btn",inactiveButtonClass:"modal__save-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},t=(e,t,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(r.inputErrorClass),n.textContent="",n.classList.remove(r.errorClass)},r=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?n(t,r):(t.classList.remove(r.inactiveButtonClass),t.disabled=!1)},n=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},o=(e,n,o)=>{const a=e.querySelector(o.submitButtonSelector);n.forEach(r=>{t(e,r,o)}),r(n,a,o)},a=e=>{document.querySelectorAll(e.formSelector).forEach(n=>{"delete-post-form"!==n.id&&((e,n)=>{const o=Array.from(e.querySelectorAll(n.inputSelector)),a=e.querySelector(n.submitButtonSelector);r(o,a,n),o.forEach(c=>{c.addEventListener("input",()=>{((e,r,n)=>{r.validity.valid?t(e,r,n):((e,t,r,n)=>{const o=e.querySelector(`#${t.id}-error`);o.textContent=r,t.classList.add(n.inputErrorClass),o.classList.add(n.errorClass)})(e,r,r.validationMessage,n)})(e,c,n),r(o,a,n)})})})(n,e)})};function c(e,t,r="Save",n="Saving..."){t.textContent=e?n:r}function s(e,t,r="Saving..."){t.preventDefault();const n=t.submitter,o=n.textContent;c(!0,n,o,r),e().then(()=>{t.target.reset()}).catch(console.error).finally(()=>{c(!1,n,o)})}a(e);let l=null,i=null;const d=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t,this._checkResponse=this._checkResponse.bind(this)}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}_request(e,t={}){return fetch(`${this._baseUrl}${e}`,{headers:this._headers,...t}).then(this._checkResponse)}getAppInfo(){return Promise.all([this._request("/cards"),this._request("/users/me")])}editUserInfo({name:e,about:t}){return this._request("/users/me",{method:"PATCH",body:JSON.stringify({name:e,about:t})})}editUserAvatar({avatar:e}){return this._request("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e})})}addNewCard({name:e,link:t}){return this._request("/cards",{method:"POST",body:JSON.stringify({name:e,link:t})})}deleteCard(e){return this._request(`/cards/${e}`,{method:"DELETE"})}likeCard(e){return this._request(`/cards/${e}/likes`,{method:"PUT"})}dislikeCard(e){return this._request(`/cards/${e}/likes`,{method:"DELETE"})}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"b3d52a96-f5c8-4919-bf09-8edcfd6eea6e","Content-Type":"application/json"}});d.getAppInfo().then(([e,t])=>{e.forEach(e=>{const t=O(e);P.append(t)}),R.textContent=t.name,j.textContent=t.about,J.src=t.avatar,J.alt=t.name,h.value=t.name,k.value=t.about}).catch(e=>{console.error(`Error: ${e}`)});const u=document.querySelector(".profile__avatar-edit-btn"),m=document.querySelector("#edit-avatar-modal"),_=m.querySelector(".modal__close-btn"),v=m.querySelector(".modal__form"),S=m.querySelector("#avatar-link-input"),y=m.querySelector(".modal__save-btn"),f=document.querySelector(".profile__edit-btn"),p=document.querySelector("#edit-profile-modal"),b=p.querySelector(".modal__close-btn"),q=p.querySelector(".modal__form"),h=p.querySelector("#profile-name-input"),k=p.querySelector("#profile-description-input"),E=document.querySelector(".profile__add-btn"),L=document.querySelector("#new-post-modal"),C=L.querySelector(".modal__close-btn"),g=L.querySelector(".modal__form"),x=L.querySelector(".modal__save-btn"),$=L.querySelector("#card-caption-input"),A=L.querySelector("#card-image-input"),U=document.querySelector("#preview-modal"),B=U.querySelector(".modal__close-btn"),w=U.querySelector(".modal__image"),T=U.querySelector(".modal__caption"),N=document.querySelector("#card-template").content.querySelector(".card"),P=document.querySelector(".cards__list"),D=e=>{e.classList.add("modal_is-opened");const t=r=>{"Escape"===r.key&&(I(e),document.removeEventListener("keydown",t))},r=t=>{t.target===e&&(I(e),e.removeEventListener("click",r))};document.addEventListener("keydown",t),e.addEventListener("click",r)},I=e=>{e.classList.remove("modal_is-opened")},O=e=>{const t=N.cloneNode(!0),r=t.querySelector(".card__image"),n=t.querySelector(".card__title"),o=t.querySelector(".card__like-btn"),a=t.querySelector(".card__delete-btn");return r.src=e.link,r.alt=e.name,n.textContent=e.name,e.isLiked?o.classList.add("card__like-btn_active"):o.classList.remove("card__like-btn_active"),o.addEventListener("click",()=>{const t=o.classList.contains("card__like-btn_active");o.disabled=!0,(t?d.dislikeCard(e._id):d.likeCard(e._id)).then(e=>{e.isLiked?o.classList.add("card__like-btn_active"):o.classList.remove("card__like-btn_active")}).catch(e=>{console.error(`Error: ${e}`)}).finally(()=>{o.disabled=!1})}),r.addEventListener("click",()=>{T.textContent=e.name,w.src=e.link,w.alt=e.name,D(U)}),a.addEventListener("click",()=>{!function(e,t){l=e,i=t._id,D(H)}(t,e)}),t};B.addEventListener("click",function(){I(U)});const R=document.querySelector(".profile__name"),j=document.querySelector(".profile__description"),J=document.querySelector(".profile__avatar");u.addEventListener("click",function(){D(m)}),_.addEventListener("click",function(){I(m)}),f.addEventListener("click",function(){h.value=R.textContent,k.value=j.textContent,o(q,[h,k],e),r([h,k],q.querySelector(e.submitButtonSelector),e),D(p)}),b.addEventListener("click",function(){I(p)}),E.addEventListener("click",function(){D(L)}),C.addEventListener("click",function(){I(L)}),q.addEventListener("submit",function(e){s(function(){return d.editUserInfo({name:h.value,about:k.value}).then(e=>{R.textContent=e.name,j.textContent=e.about,I(p)})},e,"Saving...")}),g.addEventListener("submit",function(t){s(function(){return d.addNewCard({name:$.value,link:A.value}).then(t=>{P.prepend(O(t)),I(L),n(x,e),o(g,[$,A],e)})},t,"Saving...")}),v.addEventListener("submit",function(t){s(function(){return d.editUserAvatar({avatar:S.value}).then(t=>{J.src=t.avatar,J.alt=t.name,I(m),n(y,e),o(v,[S],e)})},t,"Saving...")});const H=document.querySelector("#delete-post-modal"),z=document.querySelector("#delete-post-form");z.querySelector(".modal__delete-btn"),z.addEventListener("submit",G);const M=H.querySelector(".modal__close-btn"),F=H.querySelector(".modal__delete-btn_cancelled");function G(e){i&&s(function(){return d.deleteCard(i).then(()=>{l?.remove(),l=null,i=null,I(H)})},e,"Deleting...")}M?.addEventListener("click",()=>I(H)),F?.addEventListener("click",()=>I(H)),z.addEventListener("submit",G),a(e)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aUJBQWlCLFNBQVU2SCxHQUUxQyxNQUFNQyxFQUFxQk4sRUFBZ0JqSixjQUFjLHFCQUNuRHdKLEVBQXNCUCxFQUFnQmpKLGNBQzFDLGdDQVVGLFNBQVNzSixFQUFtQmpILEdBQ3JCYSxHQVlMZixFQVZBLFdBQ0UsT0FBT2dCLEVBQUlnQyxXQUFXakMsR0FBZ0JSLEtBQUssS0FDekNPLEdBQWM5QyxTQUNkOEMsRUFBZSxLQUNmQyxFQUFpQixLQUNqQmlGLEVBQVdjLElBRWYsRUFHMEI1RyxFQUFLLGNBQ2pDLENBckJBa0gsR0FBb0I5SCxpQkFBaUIsUUFBUyxJQUM1QzBHLEVBQVdjLElBRWJPLEdBQXFCL0gsaUJBQWlCLFFBQVMsSUFDN0MwRyxFQUFXYyxJQWtCYkksRUFBZTVILGlCQUFpQixTQUFVNkgsR0FFMUNuSSxFQUFpQmhDLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL3V0aWxzLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3NhdmUtYnRuXCIsXG4gIGRlbGV0ZUJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fZGVsZXRlLWJ0blwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zYXZlLWJ0bl9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiLFxufTtcblxuY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBlcnJvck1zZywgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGVycm9yTXNnRWwgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcblxuICBlcnJvck1zZ0VsLnRleHRDb250ZW50ID0gZXJyb3JNc2c7XG4gIGlucHV0RWwuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbiAgZXJyb3JNc2dFbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5lcnJvckNsYXNzKTtcbn07XG5cbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGVycm9yTXNnRWwgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcbiAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xuXG4gIGVycm9yTXNnRWwudGV4dENvbnRlbnQgPSBcIlwiO1xuICBlcnJvck1zZ0VsLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XG4gIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xuICAgIHNob3dJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgaW5wdXRFbC52YWxpZGF0aW9uTWVzc2FnZSwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XG4gIH1cbn07XG5cbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsKSA9PiB7XG4gICAgcmV0dXJuICFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkO1xuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCB0b2dnbGVCdXR0b25TdGF0ZSA9IChpbnB1dExpc3QsIGJ1dHRvbkVsLCBjb25maWcpID0+IHtcbiAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpKSB7XG4gICAgZGlzYWJsZUJ1dHRvbihidXR0b25FbCwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBidXR0b25FbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICBidXR0b25FbC5kaXNhYmxlZCA9IGZhbHNlO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZGlzYWJsZUJ1dHRvbiA9IChidXR0b25FbCwgY29uZmlnKSA9PiB7XG4gIGJ1dHRvbkVsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICBidXR0b25FbC5kaXNhYmxlZCA9IHRydWU7XG59O1xuXG5leHBvcnQgY29uc3QgcmVzZXRWYWxpZGF0aW9uID0gKGZvcm1FbCwgaW5wdXRMaXN0LCBjb25maWcpID0+IHtcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXQsIGNvbmZpZyk7XG4gIH0pO1xuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbn07XG5cbmNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG5cbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpO1xuXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XG4gICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKTtcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5leHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChjb25maWcpID0+IHtcbiAgY29uc3QgZm9ybUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpO1xuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWwpID0+IHtcbiAgICBpZiAoZm9ybUVsLmlkID09PSBcImRlbGV0ZS1wb3N0LWZvcm1cIikgcmV0dXJuO1xuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbCwgY29uZmlnKTtcbiAgfSk7XG59O1xuXG5lbmFibGVWYWxpZGF0aW9uKHNldHRpbmdzKTtcbiIsImV4cG9ydCBmdW5jdGlvbiByZW5kZXJMb2FkaW5nKFxuICBpc0xvYWRpbmcsXG4gIGJ1dHRvbixcbiAgYnV0dG9uVGV4dCA9IFwiU2F2ZVwiLFxuICBsb2FkaW5nVGV4dCA9IFwiU2F2aW5nLi4uXCJcbikge1xuICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gbG9hZGluZ1RleHQ7XG4gIH0gZWxzZSB7XG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gYnV0dG9uVGV4dDtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlU3VibWl0KHJlcXVlc3QsIGV2dCwgbG9hZGluZ1RleHQgPSBcIlNhdmluZy4uLlwiKSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGV2dC5zdWJtaXR0ZXI7XG5cbiAgY29uc3QgaW5pdGlhbFRleHQgPSBzdWJtaXRCdXR0b24udGV4dENvbnRlbnQ7XG5cbiAgcmVuZGVyTG9hZGluZyh0cnVlLCBzdWJtaXRCdXR0b24sIGluaXRpYWxUZXh0LCBsb2FkaW5nVGV4dCk7XG5cbiAgcmVxdWVzdCgpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgcmVuZGVyTG9hZGluZyhmYWxzZSwgc3VibWl0QnV0dG9uLCBpbml0aWFsVGV4dCk7XG4gICAgfSk7XG59XG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuaW1wb3J0IHtcbiAgZW5hYmxlVmFsaWRhdGlvbixcbiAgc2V0dGluZ3MsXG4gIHJlc2V0VmFsaWRhdGlvbixcbiAgdG9nZ2xlQnV0dG9uU3RhdGUsXG4gIGRpc2FibGVCdXR0b24sXG59IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xuaW1wb3J0IHsgaGFuZGxlU3VibWl0IH0gZnJvbSBcIi4uL3V0aWxzL3V0aWxzLmpzXCI7XG5cbmxldCBzZWxlY3RlZENhcmQgPSBudWxsO1xubGV0IHNlbGVjdGVkQ2FyZElkID0gbnVsbDtcblxuLy8gQVBJIGluc3RhbmNlXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCJiM2Q1MmE5Ni1mNWM4LTQ5MTktYmYwOS04ZWRjZmQ2ZWVhNmVcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuLy8gSW5pdGlhbGl6ZVxuYXBpXG4gIC5nZXRBcHBJbmZvKClcbiAgLnRoZW4oKFtjYXJkcywgdXNlcnNdKSA9PiB7XG4gICAgY2FyZHMuZm9yRWFjaCgoY2FyZCkgPT4ge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChjYXJkKTtcbiAgICAgIGNhcmRMaXN0LmFwcGVuZChjYXJkRWxlbWVudCk7XG4gICAgfSk7XG4gICAgcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudCA9IHVzZXJzLm5hbWU7XG4gICAgcHJvZmlsZURlc2NyaXB0aW9uRWwudGV4dENvbnRlbnQgPSB1c2Vycy5hYm91dDtcbiAgICBwcm9maWxlQXZhdGFyRWwuc3JjID0gdXNlcnMuYXZhdGFyO1xuICAgIHByb2ZpbGVBdmF0YXJFbC5hbHQgPSB1c2Vycy5uYW1lO1xuICAgIGVkaXRQcm9maWxlTmFtZUlucHV0LnZhbHVlID0gdXNlcnMubmFtZTtcbiAgICBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSB1c2Vycy5hYm91dDtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmVycm9yKGBFcnJvcjogJHtlcnJ9YCk7XG4gIH0pO1xuXG4vLyBFZGl0IGF2YXRhciBtb2RhbCBlbGVtZW50c1xuY29uc3QgZWRpdEF2YXRhckJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWVkaXQtYnRuXCIpO1xuY29uc3QgZWRpdEF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LWF2YXRhci1tb2RhbFwiKTtcbmNvbnN0IGVkaXRBdmF0YXJDbG9zZUJ0biA9IGVkaXRBdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBlZGl0QXZhdGFyRm9ybSA9IGVkaXRBdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgZWRpdEF2YXRhcklucHV0ID0gZWRpdEF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLWxpbmstaW5wdXRcIik7XG5jb25zdCBlZGl0QXZhdGFyU3VibWl0QnRuID0gZWRpdEF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3NhdmUtYnRuXCIpO1xuXG4vLyBFZGl0IHByb2ZpbGUgbW9kYWwgZWxlbWVudHNcbmNvbnN0IGVkaXRQcm9maWxlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ0blwiKTtcbmNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcbmNvbnN0IGVkaXRQcm9maWxlQ2xvc2VCdG4gPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IGVkaXRQcm9maWxlRm9ybSA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGVkaXRQcm9maWxlTmFtZUlucHV0ID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLW5hbWUtaW5wdXRcIlxuKTtcbmNvbnN0IGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dFwiXG4pO1xuLy8gTmV3IHBvc3QgbW9kYWwgZWxlbWVudHNcbmNvbnN0IG5ld1Bvc3RNb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ0blwiKTtcbmNvbnN0IG5ld1Bvc3RNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LXBvc3QtbW9kYWxcIik7XG5jb25zdCBuZXdQb3N0Q2xvc2VCdG4gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuY29uc3QgbmV3UG9zdEZvcm0gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IG5ld1Bvc3RTdWJtaXRCdG4gPSBuZXdQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc2F2ZS1idG5cIik7XG5jb25zdCBuZXdQb3N0TmFtZUlucHV0ID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC1jYXB0aW9uLWlucHV0XCIpO1xuY29uc3QgbmV3UG9zdExpbmtJbnB1dCA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtaW1hZ2UtaW5wdXRcIik7XG4vLyBQcmV2aWV3IG1vZGFsIGVsZW1lbnRzXG5jb25zdCBwcmV2aWV3TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbW9kYWxcIik7XG5jb25zdCBwcmV2aWV3TW9kYWxDbG9zZUJ0biA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBwcmV2aWV3SW1hZ2UgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2VcIik7XG5jb25zdCBwcmV2aWV3Q2FwdGlvbiA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuXG4vLyBUZW1wbGF0ZSBhbmQgY2FyZCBsaXN0XG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudFxuICAucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpXG4gIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKTtcbmNvbnN0IGNhcmRMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcblxuLy8gT3BlbiBhbmQgY2xvc2UgbW9kYWwgZnVuY3Rpb25zXG5cbmNvbnN0IG9wZW5Nb2RhbCA9IChtb2RhbCkgPT4ge1xuICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xuXG4gIGNvbnN0IGhhbmRsZUVzY0Nsb3NlID0gKGV2dCkgPT4ge1xuICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICBjbG9zZU1vZGFsKG1vZGFsKTtcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY0Nsb3NlKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGhhbmRsZU92ZXJsYXlDbG9zZSA9IChldnQpID0+IHtcbiAgICBpZiAoZXZ0LnRhcmdldCA9PT0gbW9kYWwpIHtcbiAgICAgIGNsb3NlTW9kYWwobW9kYWwpO1xuICAgICAgbW9kYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZU92ZXJsYXlDbG9zZSk7XG4gICAgfVxuICB9O1xuXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY0Nsb3NlKTtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZU92ZXJsYXlDbG9zZSk7XG59O1xuXG5jb25zdCBjbG9zZU1vZGFsID0gKG1vZGFsKSA9PiB7XG4gIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9pcy1vcGVuZWRcIik7XG59O1xuXG5mdW5jdGlvbiBzZXRCdXR0b25Mb2FkaW5nKGJ0biwgaXNMb2FkaW5nLCBpZGxlVGV4dCwgbG9hZGluZ1RleHQpIHtcbiAgaWYgKCFidG4pIHJldHVybjtcbiAgYnRuLnRleHRDb250ZW50ID0gaXNMb2FkaW5nID8gbG9hZGluZ1RleHQgOiBpZGxlVGV4dDtcbiAgYnRuLmRpc2FibGVkID0gaXNMb2FkaW5nO1xufVxuXG4vLyBEZWxldGUgY2FyZCBtb2RhbCBlbGVtZW50cyBhbmQgaGFuZGxlcnNcbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGRhdGEpIHtcbiAgc2VsZWN0ZWRDYXJkID0gY2FyZEVsZW1lbnQ7XG4gIHNlbGVjdGVkQ2FyZElkID0gZGF0YS5faWQ7XG4gIG9wZW5Nb2RhbChkZWxldGVQb3N0TW9kYWwpO1xufVxuXG5jb25zdCBnZXRDYXJkRWxlbWVudCA9IChkYXRhKSA9PiB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcbiAgY29uc3QgY2FyZEltYWdlID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgY29uc3QgY2FyZFRpdGxlID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcbiAgY29uc3QgY2FyZExpa2VCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xuICBjb25zdCBjYXJkRGVsZXRlQnRuID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnRuXCIpO1xuXG4gIGNhcmRJbWFnZS5zcmMgPSBkYXRhLmxpbms7XG4gIGNhcmRJbWFnZS5hbHQgPSBkYXRhLm5hbWU7XG4gIGNhcmRUaXRsZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcblxuICBpZiAoZGF0YS5pc0xpa2VkKSB7XG4gICAgY2FyZExpa2VCdG4uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnRuX2FjdGl2ZVwiKTtcbiAgfSBlbHNlIHtcbiAgICBjYXJkTGlrZUJ0bi5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZF9fbGlrZS1idG5fYWN0aXZlXCIpO1xuICB9XG5cbiAgY2FyZExpa2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjb25zdCBpc0FjdGl2ZSA9IGNhcmRMaWtlQnRuLmNsYXNzTGlzdC5jb250YWlucyhcImNhcmRfX2xpa2UtYnRuX2FjdGl2ZVwiKTtcblxuICAgIGNhcmRMaWtlQnRuLmRpc2FibGVkID0gdHJ1ZTtcblxuICAgIGNvbnN0IHJlcSA9IGlzQWN0aXZlID8gYXBpLmRpc2xpa2VDYXJkKGRhdGEuX2lkKSA6IGFwaS5saWtlQ2FyZChkYXRhLl9pZCk7XG5cbiAgICByZXFcbiAgICAgIC50aGVuKCh1cGRhdGVkQ2FyZCkgPT4ge1xuICAgICAgICBpZiAodXBkYXRlZENhcmQuaXNMaWtlZCkge1xuICAgICAgICAgIGNhcmRMaWtlQnRuLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ0bl9hY3RpdmVcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2FyZExpa2VCdG4uY2xhc3NMaXN0LnJlbW92ZShcImNhcmRfX2xpa2UtYnRuX2FjdGl2ZVwiKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yOiAke2Vycn1gKTtcbiAgICAgIH0pXG4gICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgIGNhcmRMaWtlQnRuLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICB9KTtcbiAgfSk7XG5cbiAgY2FyZEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgcHJldmlld0NhcHRpb24udGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgcHJldmlld0ltYWdlLnNyYyA9IGRhdGEubGluaztcbiAgICBwcmV2aWV3SW1hZ2UuYWx0ID0gZGF0YS5uYW1lO1xuICAgIG9wZW5Nb2RhbChwcmV2aWV3TW9kYWwpO1xuICB9KTtcblxuICBjYXJkRGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgZGF0YSk7XG4gIH0pO1xuXG4gIHJldHVybiBjYXJkRWxlbWVudDtcbn07XG5cbi8vIFByZXZpZXcgbW9kYWwgY2xvc2UgaGFuZGxlclxuZnVuY3Rpb24gaGFuZGxlUHJldmlld01vZGFsQ2xvc2UoKSB7XG4gIGNsb3NlTW9kYWwocHJldmlld01vZGFsKTtcbn1cbnByZXZpZXdNb2RhbENsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVQcmV2aWV3TW9kYWxDbG9zZSk7XG5cbi8vIFByb2ZpbGUgZWxlbWVudHNcbmNvbnN0IHByb2ZpbGVOYW1lRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb25FbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIik7XG5jb25zdCBwcm9maWxlQXZhdGFyRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcblxuLy8gRXZlbnQgbGlzdGVuZXJzIGZvciBvcGVuaW5nIGFuZCBjbG9zaW5nIG1vZGFsc1xuXG5lZGl0QXZhdGFyQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIG9wZW5Nb2RhbChlZGl0QXZhdGFyTW9kYWwpO1xufSk7XG5cbmVkaXRBdmF0YXJDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBjbG9zZU1vZGFsKGVkaXRBdmF0YXJNb2RhbCk7XG59KTtcblxuZWRpdFByb2ZpbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgZWRpdFByb2ZpbGVOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZUVsLnRleHRDb250ZW50O1xuICBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb25FbC50ZXh0Q29udGVudDtcblxuICByZXNldFZhbGlkYXRpb24oXG4gICAgZWRpdFByb2ZpbGVGb3JtLFxuICAgIFtlZGl0UHJvZmlsZU5hbWVJbnB1dCwgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0XSxcbiAgICBzZXR0aW5nc1xuICApO1xuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKFxuICAgIFtlZGl0UHJvZmlsZU5hbWVJbnB1dCwgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0XSxcbiAgICBlZGl0UHJvZmlsZUZvcm0ucXVlcnlTZWxlY3RvcihzZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvciksXG4gICAgc2V0dGluZ3NcbiAgKTtcblxuICBvcGVuTW9kYWwoZWRpdFByb2ZpbGVNb2RhbCk7XG59KTtcblxuZWRpdFByb2ZpbGVDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xufSk7XG5cbm5ld1Bvc3RNb2RhbEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBvcGVuTW9kYWwobmV3UG9zdE1vZGFsKTtcbn0pO1xubmV3UG9zdENsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKTtcbn0pO1xuXG4vLyBGb3JtIHN1Ym1pdCBoYW5kbGVyc1xuXG5mdW5jdGlvbiBoYW5kbGVFZGl0UHJvZmlsZVN1Ym1pdChldnQpIHtcbiAgZnVuY3Rpb24gbWFrZVJlcXVlc3QoKSB7XG4gICAgcmV0dXJuIGFwaVxuICAgICAgLmVkaXRVc2VySW5mbyh7XG4gICAgICAgIG5hbWU6IGVkaXRQcm9maWxlTmFtZUlucHV0LnZhbHVlLFxuICAgICAgICBhYm91dDogZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlLFxuICAgICAgfSlcbiAgICAgIC50aGVuKCh1c2VyKSA9PiB7XG4gICAgICAgIHByb2ZpbGVOYW1lRWwudGV4dENvbnRlbnQgPSB1c2VyLm5hbWU7XG4gICAgICAgIHByb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50ID0gdXNlci5hYm91dDtcbiAgICAgICAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbiAgICAgIH0pO1xuICB9XG4gIGhhbmRsZVN1Ym1pdChtYWtlUmVxdWVzdCwgZXZ0LCBcIlNhdmluZy4uLlwiKTtcbn1cbmVkaXRQcm9maWxlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUVkaXRQcm9maWxlU3VibWl0KTtcblxuZnVuY3Rpb24gaGFuZGxlQWRkQ2FyZFN1Ym1pdChldnQpIHtcbiAgZnVuY3Rpb24gbWFrZVJlcXVlc3QoKSB7XG4gICAgcmV0dXJuIGFwaVxuICAgICAgLmFkZE5ld0NhcmQoe1xuICAgICAgICBuYW1lOiBuZXdQb3N0TmFtZUlucHV0LnZhbHVlLFxuICAgICAgICBsaW5rOiBuZXdQb3N0TGlua0lucHV0LnZhbHVlLFxuICAgICAgfSlcbiAgICAgIC50aGVuKChjYXJkKSA9PiB7XG4gICAgICAgIGNhcmRMaXN0LnByZXBlbmQoZ2V0Q2FyZEVsZW1lbnQoY2FyZCkpO1xuICAgICAgICBjbG9zZU1vZGFsKG5ld1Bvc3RNb2RhbCk7XG4gICAgICAgIC8vIGhhbmRsZVN1Ym1pdCB3aWxsIHJlc2V0IHRoZSBmb3JtOyBkbyB5b3VyIGV4dHJhczpcbiAgICAgICAgZGlzYWJsZUJ1dHRvbihuZXdQb3N0U3VibWl0QnRuLCBzZXR0aW5ncyk7XG4gICAgICAgIHJlc2V0VmFsaWRhdGlvbihcbiAgICAgICAgICBuZXdQb3N0Rm9ybSxcbiAgICAgICAgICBbbmV3UG9zdE5hbWVJbnB1dCwgbmV3UG9zdExpbmtJbnB1dF0sXG4gICAgICAgICAgc2V0dGluZ3NcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICB9XG4gIGhhbmRsZVN1Ym1pdChtYWtlUmVxdWVzdCwgZXZ0LCBcIlNhdmluZy4uLlwiKTtcbn1cbm5ld1Bvc3RGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlQWRkQ2FyZFN1Ym1pdCk7XG5cbmZ1bmN0aW9uIGhhbmRsZUVkaXRBdmF0YXJTdWJtaXQoZXZ0KSB7XG4gIGZ1bmN0aW9uIG1ha2VSZXF1ZXN0KCkge1xuICAgIHJldHVybiBhcGlcbiAgICAgIC5lZGl0VXNlckF2YXRhcih7IGF2YXRhcjogZWRpdEF2YXRhcklucHV0LnZhbHVlIH0pXG4gICAgICAudGhlbigodXNlcikgPT4ge1xuICAgICAgICBwcm9maWxlQXZhdGFyRWwuc3JjID0gdXNlci5hdmF0YXI7XG4gICAgICAgIHByb2ZpbGVBdmF0YXJFbC5hbHQgPSB1c2VyLm5hbWU7XG4gICAgICAgIGNsb3NlTW9kYWwoZWRpdEF2YXRhck1vZGFsKTtcbiAgICAgICAgZGlzYWJsZUJ1dHRvbihlZGl0QXZhdGFyU3VibWl0QnRuLCBzZXR0aW5ncyk7XG4gICAgICAgIHJlc2V0VmFsaWRhdGlvbihlZGl0QXZhdGFyRm9ybSwgW2VkaXRBdmF0YXJJbnB1dF0sIHNldHRpbmdzKTtcbiAgICAgIH0pO1xuICB9XG4gIGhhbmRsZVN1Ym1pdChtYWtlUmVxdWVzdCwgZXZ0LCBcIlNhdmluZy4uLlwiKTtcbn1cbmVkaXRBdmF0YXJGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlRWRpdEF2YXRhclN1Ym1pdCk7XG5cbmNvbnN0IGRlbGV0ZVBvc3RNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLXBvc3QtbW9kYWxcIik7XG5jb25zdCBkZWxldGVQb3N0Rm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLXBvc3QtZm9ybVwiKTtcbmNvbnN0IGRlbGV0ZVBvc3REZWxldGVCdG4gPSBkZWxldGVQb3N0Rm9ybS5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19kZWxldGUtYnRuXCIpO1xuZGVsZXRlUG9zdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVEZWxldGVTdWJtaXQpO1xuXG5jb25zdCBkZWxldGVQb3N0Q2xvc2VCdG4gPSBkZWxldGVQb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuY29uc3QgZGVsZXRlUG9zdENhbmNlbEJ0biA9IGRlbGV0ZVBvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fZGVsZXRlLWJ0bl9jYW5jZWxsZWRcIlxuKTtcblxuZGVsZXRlUG9zdENsb3NlQnRuPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cbiAgY2xvc2VNb2RhbChkZWxldGVQb3N0TW9kYWwpXG4pO1xuZGVsZXRlUG9zdENhbmNlbEJ0bj8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XG4gIGNsb3NlTW9kYWwoZGVsZXRlUG9zdE1vZGFsKVxuKTtcblxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlU3VibWl0KGV2dCkge1xuICBpZiAoIXNlbGVjdGVkQ2FyZElkKSByZXR1cm47XG5cbiAgZnVuY3Rpb24gbWFrZVJlcXVlc3QoKSB7XG4gICAgcmV0dXJuIGFwaS5kZWxldGVDYXJkKHNlbGVjdGVkQ2FyZElkKS50aGVuKCgpID0+IHtcbiAgICAgIHNlbGVjdGVkQ2FyZD8ucmVtb3ZlKCk7XG4gICAgICBzZWxlY3RlZENhcmQgPSBudWxsO1xuICAgICAgc2VsZWN0ZWRDYXJkSWQgPSBudWxsO1xuICAgICAgY2xvc2VNb2RhbChkZWxldGVQb3N0TW9kYWwpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gU2hvd3MgXCJEZWxldGluZy4uLlwiIG9uIHRoZSBjbGlja2VkIGJ1dHRvbiwgdGhlbiByZXN0b3JlcyBvcmlnaW5hbCB0ZXh0XG4gIGhhbmRsZVN1Ym1pdChtYWtlUmVxdWVzdCwgZXZ0LCBcIkRlbGV0aW5nLi4uXCIpO1xufVxuZGVsZXRlUG9zdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVEZWxldGVTdWJtaXQpO1xuXG5lbmFibGVWYWxpZGF0aW9uKHNldHRpbmdzKTtcbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gICAgdGhpcy5fY2hlY2tSZXNwb25zZSA9IHRoaXMuX2NoZWNrUmVzcG9uc2UuYmluZCh0aGlzKTtcbiAgfVxuICBfY2hlY2tSZXNwb25zZShyZXMpIHtcbiAgICByZXR1cm4gcmVzLm9rID8gcmVzLmpzb24oKSA6IFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICB9XG5cbiAgX3JlcXVlc3QocGF0aCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9JHtwYXRofWAsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAuLi5vcHRpb25zLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5fcmVxdWVzdChcIi9jYXJkc1wiKSwgdGhpcy5fcmVxdWVzdChcIi91c2Vycy9tZVwiKV0pO1xuICB9XG5cbiAgZWRpdFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KFwiL3VzZXJzL21lXCIsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBhYm91dCB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIGVkaXRVc2VyQXZhdGFyKHsgYXZhdGFyIH0pIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChcIi91c2Vycy9tZS9hdmF0YXJcIiwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGF2YXRhciB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIGFkZE5ld0NhcmQoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChcIi9jYXJkc1wiLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBsaW5rIH0pLFxuICAgIH0pO1xuICB9XG5cbiAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgL2NhcmRzLyR7Y2FyZElkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICB9KTtcbiAgfVxuXG4gIGxpa2VDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAvY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgIH0pO1xuICB9XG5cbiAgZGlzbGlrZUNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYC9jYXJkcy8ke2NhcmRJZH0vbGlrZXNgLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIl0sIm5hbWVzIjpbInNldHRpbmdzIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiZGVsZXRlQnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsIiwiaW5wdXRFbCIsImNvbmZpZyIsImVycm9yTXNnRWwiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJ0ZXh0Q29udGVudCIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWwiLCJzb21lIiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVCdXR0b24iLCJkaXNhYmxlZCIsImFkZCIsInJlc2V0VmFsaWRhdGlvbiIsImJ1dHRvbkVsZW1lbnQiLCJmb3JFYWNoIiwiaW5wdXQiLCJlbmFibGVWYWxpZGF0aW9uIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJBcnJheSIsImZyb20iLCJhZGRFdmVudExpc3RlbmVyIiwiY2hlY2tJbnB1dFZhbGlkaXR5Iiwic2hvd0lucHV0RXJyb3IiLCJlcnJvck1zZyIsInZhbGlkYXRpb25NZXNzYWdlIiwicmVuZGVyTG9hZGluZyIsImlzTG9hZGluZyIsImJ1dHRvbiIsImJ1dHRvblRleHQiLCJsb2FkaW5nVGV4dCIsImhhbmRsZVN1Ym1pdCIsInJlcXVlc3QiLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdEJ1dHRvbiIsInN1Ym1pdHRlciIsImluaXRpYWxUZXh0IiwidGhlbiIsInRhcmdldCIsInJlc2V0IiwiY2F0Y2giLCJjb25zb2xlIiwiZXJyb3IiLCJmaW5hbGx5Iiwic2VsZWN0ZWRDYXJkIiwic2VsZWN0ZWRDYXJkSWQiLCJhcGkiLCJjb25zdHJ1Y3RvciIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfY2hlY2tSZXNwb25zZSIsImJpbmQiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiX3JlcXVlc3QiLCJwYXRoIiwib3B0aW9ucyIsImZldGNoIiwiZ2V0QXBwSW5mbyIsImFsbCIsImVkaXRVc2VySW5mbyIsIm5hbWUiLCJhYm91dCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZWRpdFVzZXJBdmF0YXIiLCJhdmF0YXIiLCJhZGROZXdDYXJkIiwibGluayIsImRlbGV0ZUNhcmQiLCJjYXJkSWQiLCJsaWtlQ2FyZCIsImRpc2xpa2VDYXJkIiwiYXV0aG9yaXphdGlvbiIsImNhcmRzIiwidXNlcnMiLCJjYXJkIiwiY2FyZEVsZW1lbnQiLCJnZXRDYXJkRWxlbWVudCIsImNhcmRMaXN0IiwiYXBwZW5kIiwicHJvZmlsZU5hbWVFbCIsInByb2ZpbGVEZXNjcmlwdGlvbkVsIiwicHJvZmlsZUF2YXRhckVsIiwic3JjIiwiYWx0IiwiZWRpdFByb2ZpbGVOYW1lSW5wdXQiLCJ2YWx1ZSIsImVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsImVyciIsImVkaXRBdmF0YXJCdG4iLCJlZGl0QXZhdGFyTW9kYWwiLCJlZGl0QXZhdGFyQ2xvc2VCdG4iLCJlZGl0QXZhdGFyRm9ybSIsImVkaXRBdmF0YXJJbnB1dCIsImVkaXRBdmF0YXJTdWJtaXRCdG4iLCJlZGl0UHJvZmlsZUJ0biIsImVkaXRQcm9maWxlTW9kYWwiLCJlZGl0UHJvZmlsZUNsb3NlQnRuIiwiZWRpdFByb2ZpbGVGb3JtIiwibmV3UG9zdE1vZGFsQnRuIiwibmV3UG9zdE1vZGFsIiwibmV3UG9zdENsb3NlQnRuIiwibmV3UG9zdEZvcm0iLCJuZXdQb3N0U3VibWl0QnRuIiwibmV3UG9zdE5hbWVJbnB1dCIsIm5ld1Bvc3RMaW5rSW5wdXQiLCJwcmV2aWV3TW9kYWwiLCJwcmV2aWV3TW9kYWxDbG9zZUJ0biIsInByZXZpZXdJbWFnZSIsInByZXZpZXdDYXB0aW9uIiwiY2FyZFRlbXBsYXRlIiwiY29udGVudCIsIm9wZW5Nb2RhbCIsIm1vZGFsIiwiaGFuZGxlRXNjQ2xvc2UiLCJrZXkiLCJjbG9zZU1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImhhbmRsZU92ZXJsYXlDbG9zZSIsImRhdGEiLCJjbG9uZU5vZGUiLCJjYXJkSW1hZ2UiLCJjYXJkVGl0bGUiLCJjYXJkTGlrZUJ0biIsImNhcmREZWxldGVCdG4iLCJpc0xpa2VkIiwiaXNBY3RpdmUiLCJjb250YWlucyIsIl9pZCIsInVwZGF0ZWRDYXJkIiwiZGVsZXRlUG9zdE1vZGFsIiwiaGFuZGxlRGVsZXRlQ2FyZCIsInVzZXIiLCJwcmVwZW5kIiwiZGVsZXRlUG9zdEZvcm0iLCJoYW5kbGVEZWxldGVTdWJtaXQiLCJkZWxldGVQb3N0Q2xvc2VCdG4iLCJkZWxldGVQb3N0Q2FuY2VsQnRuIl0sInNvdXJjZVJvb3QiOiIifQ==